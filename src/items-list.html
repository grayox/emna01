<!-- Uses <iron-data-table> -->

<link rel="import" href="../bower_components/polymer/polymer.html">
<!--- ->
Replaced <vaadin-grid> (https://github.com/vaadin/vaadin-grid)
with <iron-data-table> (https://github.com/Saulis/iron-data-table)
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
<!---->
<link rel="import" href="../bower_components/iron-data-table/iron-data-table.html">
<link rel="import" href="../bower_components/iron-data-table/default-styles.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="moment-js.html">

<link rel="import" href="custom/row-detail.html">

<!-- Edit -->
<link rel="import" href="custom/styles/grid-1.html">
<!-- endEdit -->

<!--- ->
Examples: http://jsbin.com/xxxxxxxxxx/1/edit?html,output
          torizajafe ... Hello world
          yexokijavo ... CSS import
          fanotababa ... Row details
          boxiyafoya ... Edit row details
          sevafikolu ... Edit row details using sub-element
          zukahavoto ... Reset selection 01
          ducayiwake ... Reset selection 02
          xucemijada ... Reset selection 03 http://stackoverflow.com/q/38707525/1640892
          dubuyoy    ... Reset selection 04 http://stackoverflow.com/a/38712926/1640892
          fewihuxozu ... Select row, prevent deselection | Clone for documentation purposes
<!---->

<dom-module id="items-list">
  <template>
		<style include="grid-1"></style><!-- Alternate styling based on: https://saulis.github.io/iron-data-table/demo/styling.html -->
    <style>
      :host {
        position: relative;
        display: flex;
        flex-direction: column;
        background: #fff;
      }

      #add-button {
        position: absolute;
        right: 32px;
        bottom: 32px;
        z-index: 2;
      }

      @media (max-width: 1124px) {
        #add-button {
          bottom: -28px;
        }
      }

      @media (min-width: 1125px) {
        #add-button {
          bottom: auto;
          top: -29px;
        }
      }

      @media (max-width: 900px) {
        #add-button {
          bottom: 32px;
        }
      }

      #items {
        flex: 1;
        color: var(--primary-text-color);
      }

      @media (max-width: 1124px) {
        #items {
          font-size: 15px;
        }
      }
			/** /
      #items /deep/ thead.vaadin-grid-header {
        box-shadow: 0 -9px 2px 10px rgba(0, 0, 0, 0.1), 0 -8px 3px 10px rgba(204, 204, 204, 0.20);
      }

      #items /deep/ thead.vaadin-grid-header th {
        text-transform: uppercase;
        font-size: 12px;
        font-weight: 500;
        color: var(--primary-text-color);
      }

      vaadin-grid /deep/ .total {
        flex-direction: row-reverse;
      }

      vaadin-grid /deep/ td.status-new {
        color: var(--accent-color);
        font-weight: 500;
      }

      vaadin-grid /deep/ td.status-in_progress {
        font-weight: 500;
        font-style: italic;
        text-transform: capitalize;
      }

      vaadin-grid /deep/ td.comment {
        position: relative;
      }

      vaadin-grid /deep/ td.comment span {
        width: 100%;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        padding-right: 35px;
        box-sizing: border-box;
      }

      #items /deep/ .vaadin-grid-header [class*="sort-"]:after {
        content: "";
        border-width: 5px;
        border-style: solid;
        border-color: transparent;
        width: 0;
        padding: 0;
        min-width: 0;
        margin: 0 10px;
      }

      #items /deep/ .vaadin-grid-header.vaadin-grid .sort-desc.vaadin-grid:after {
        border-top-color: var(--accent-color);
        transform: translateY(25%);
      }

      #items /deep/ .vaadin-grid-header.vaadin-grid .sort-asc.vaadin-grid:after {
        border-bottom-color: var(--accent-color);
        transform: translateY(-25%);
      }
			/**/
    </style>
    <style>
      iron-data-table data-table-row-detail {
        height: 150px;
      }
      iron-data-table data-table-row-detail .detail {
        width: 100%;
        display: flex;
        justify-content: space-around;
        align-items: center;
        border: 2px solid #aaa;
      }
    </style>


		<iron-data-table id="grid1"
										 items="[[items]]"
										 xdetails-enabled
										 selection-enabled
										 selected-item="{{selectedItem}}"
										 on-deselecting-item="_deselecting"
										 >
			
			<template is="row-detail">
				<div class="detail">
					<row-detail item="{{item}}"
											tabindex="0"
											>
					</row-detail><!-- tabindex="0" is required workaround per http://stackoverflow.com/a/38693110/1640892 -->
				</div>
			</template>
			
			<data-table-column name="Comment"
												 xwidth="50px"
												 xflex="0"
												 filter-by="comment"
												 sort-by="comment"
												 >
				<template>[[item.comment]]</template>
			</data-table-column>
			<data-table-column name="Total"
												 filter-by="total"
												 sort-by="total"
												 >
				<template>[[item.total]]</template>
			</data-table-column>
			<data-table-column name="Merchant"
												 >
				<template>[[item.merchant]]</template>
			</data-table-column>
		</iron-data-table>
		<!---->
    [[_computeSelectedStr(selectedItem)]]
		<!---->
    <paper-fab icon="add"
							 id="add-button"
							 on-tap="_showItemEditor"
							 xon-tap="show">
		</paper-fab>
		<!---->

  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'items-list',
				properties: {
          items: Array,
          filters: Object,
          selectedItem: {
						type: Object,
						notifies: true,
					},
          sortColumn: String,
          sortDirection: String,
				},
				
				/**/
				observers: [
          '_selectedItemChanged(selectedItem)' ,
				],
				/**/
				
        _deselecting: function(e) {
          e.preventDefault();
					this._selectedItemChanged(e.detail.item);
        },

				_selectedItemChanged: function(ob) {
					//console.log('selectedItem', ob);
					this.fire('item-edit', ob);
				},

				/**/
				
        _showItemEditor: function() {
          this.fire('item-edit', {});
        },
				
				reset: function() {
					this.set('selectedItem', null);
				},

				_computeSelectedStr: function(ob) {
				  return JSON.stringify(ob);
        },

				show: function() {
					console.log('selectedItem', this.selectedItem);
				},

				
      });
    })();
  </script>
</dom-module>
